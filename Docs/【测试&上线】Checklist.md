Title: 百步梯技术部活动页面测试&上线 Checklist

Date: 2018.09.29

Author: Kingsley

## 简介
这份文档主要基于活动页面线上常见问题整理，用于后续的各类测试自查，以避免重复踩进相同的坑。

请大家在遇到常见的易忽视问题时，在定位到问题根源、找出解决方案后添加进该文档。

另外，能写单元测试的当然是最好，但是综合考虑到各种因素，以下建议仅针对手动测试。

## 1. 要求 100% 达到
### 安全问题
- 涉及到用户密码的，必须使用语言或框架提供的专用于密码加密和验证的函数/库
- 涉及到显示/存储用户输入内容的，必须保证对代码注入的防御(主要是前端的 XSS 注入和后端的 SQL 注入）
- 涉及到需要权限访问的数据，必须保证有严格的权限验证控制

### 编码问题
使用 MySQL 时，**数据库的编码** 和 **连接数据库所用的编码** 原则上都使用 `utf8mb4`，务必测试 emoji 能否正常处理显示。

> 简要解释：MySQL 提供的 `utf8` 字符编码只支持最多三个字节的字符，而实际上 UTF-8 可能会出现四个字节的字符（如 emoji 等）。由于历史原因，MySQL 没有对这个问题进行修复，而是添加了 `utf8mb4` 编码方式作为替代。
>
> 要注意连接的编码也需要手动设置为 `utf8mb4`，否则仍然会导致处理四字节字符时出现问题。
>
> 参考 [In MySQL, never use “utf8”. Use “utf8mb4”.](https://medium.com/@adamhooper/in-mysql-never-use-utf8-use-utf8mb4-11761243e434)

其它文件/字符串等相关内容也统一全部使用 UTF-8 的编码，避免在任何地方使用 GBK、GB2312 等编码方式。

另外，导出数据如果使用 CSV 的格式，直接用 UTF-8 编码时可能会导致桌面端 Excel 的默认设置读取成乱码，此时不要为了快速解决问题就使用 GB2312 编码，而应使用带 `BOM` 的 UTF-8 编码方式，具体实现方式就是在文本文件的开头添加一个特殊的字符，示例如下：

JavaScript:

```javascript
var utf8_with_bom = '\ufeff' + utf8_string;
```

PHP:

```PHP
$utf8_with_bom = chr(239) . chr(187) . chr(191) . $utf8_string;
```

其它语言的实现方式可以自己搜索，关键词大致类似 "Encoding a string as UTF-8 with BOM in LANGUAGE_NAME"。

在 VSCode/Sublime Text 等各类常见文本编辑器内的 `Save With Encoding` 选项里面有 `UTF-8 With BOM` 的选项，可以自己分别使用两种编码方式保存，查看一下实际效果。

### 配置问题
所有会因系统版本、环境等而不同的值，都必须写进单独的配置文件，如数据库名、数据库密码、数据库用户名等。

### 流程问题
多在用户的角度思考操作流程，如报名页面在点击提交后，前端应禁用按钮直到后端返回操作结果，这样防止因网络问题导致的重复提交多条记录，毕竟一般报名表的后台是不会考虑进行加锁操作的。

### 规范问题
除了代码规范以外，各个请求和响应都需要尽可能遵循 HTTP 协议的标准，如 JSON 类型的数据返回的 header 应有 `Content-Type: application/json`，PNG 图片有 `Content-Type:  image/png` 等，不能完全使用默认的设置然后给前端自己解析。

*讲点个人观点：虽然无论对于发送方还是接收方，计算机所处理的实际上都是二进制的数据而已，当然大可进行随意的发送接收，只要两边能正常对接然后完成工作即可，在使用者看来是没什么区别的。但如果不遵循这些规范而让各自去做额外的判断、解析等工作，一方面是加大了不必要的工作量，另一方面也意味着这是一个非常敷衍的行为，举个简单的例子来说，各类开发调试工具都是基于这些国际通用标准来实现的，那如果返回的是图片而实际上给的 header 又说是 html 文档的话，它们一般会按照 header 的格式来给预览，这个时候把图片强行解析成文本就会导致预览的是一堆乱码了，同样地，JSON 类型不设置好而用文本来预览的话，看起来会非常麻烦，这些情况可以在 Chrome 控制台的预览上试试看。尽管现在很多时候，工具或者接收方对格式的要求不是那么高，可以智能判断和识别，但我觉得至少在初级阶段，基本的这些标准还是得好好遵守的，毕竟使用通用的标准意味着大部分的工具都能直接适配。而且我相信，大部分的时候，没有遵循这个标准并不是因为这是在考虑一些特殊的情况后做出的权衡，而是因为根本没有这个意识。*

### iOS 设备相关问题
##### 时间选择
注意测试 iOS 设备涉及到时间选择等的功能是否正常。

##### 子元素圆角
好像还没找到具体原因？（

似乎是因为 iOS 下有圆角的元素的 `overflow: hidden` 遮不住子元素的尖角，结果就导致一个设置了圆角的元素会仍然显示出子元素颜色填充在方块和圆角矩形之间。

##### inline-block 的元素空隙
可尝试使用：负 `margin`、换行闭合标签、删除两个标签之间的间隔符（空格、换行等）

## 2. 建议实现
### 活动结束时间设置
报名表等活动，需要设置结束时间，并写进配置文件方便修改。

在检测到访问时间已经超过结束时间时，前端后端都需要给用户提示，前端防止用户在过期时间误操作填写报名表，同时后端验证避免出现在过期时间绕过前端页面直接提交数据的操作。

注意保证用户体验，可能部分页面是允许一直访问的，如 2018 年毕业季的时光胶囊在活动结束后不允许寄信，但应允许查看数量等，具体的原则可以和策划者协商，或者和设计讨论。不要再出现活动结束后重命名项目文件或者直接保留等情况，容易引起用户的误解或者误操作。

### 报名表数据统计页面
参考近年的数据统计页面，主要锻炼写 SQL 语句的能力。

### 报名表南北校学院区分
根据选择的学院，动态改变可供选择的部门列表，主要为了避免线上南北校技术部的误报名。

可以和北校技术部一起商量具体招新的计划，防止每年招新时南北校的技术部招新都比较乱，最后还要去手动修改和分流。

附大二需转北校的学院列表，供参考：机械与汽车工程学院、建筑学院、材料科学与工程学院、电子与信息学院、轻工科学与工程学院、自动化科学与工程学院、物理与光电学院、数学学院、电力学院、食品科学与工程学院、化学与化工学院、土木与交通学院、公共管理学院、工商管理学院。

## 3. 有时间可以做

### 数据查询页面
可根据具体的需求确定，如报名表数据查询可以显示所有或者分部门输入密码查看等。

### 活动开始时间设置
参考“活动结束时间设置”部分，如果时间来不及的话这个一般没有特别大的必要，但是如果是有开始时间设置的活动就必须加上了，毕竟不是每个项目都是部署好就算上线的。

### ~~千万不要有什么“我先睡个十分钟再继续”的想法~~
